ISPMAX - RouterOS Configuration Script v1.0

Autor: ISPMAX Senior Engineer

Funciones: QoS Cake/PCQ, Firewall, Corte por Impago, API

/system identity set name="ISPMAX-NOC-01"

1. Habilitar API Service (Crucial para el backend Flask)

/ip service set api disabled=no port=8728 address=0.0.0.0/0

2. Crear Address List para Cortes de Servicio

Los clientes en esta lista serán bloqueados o redirigidos

/ip firewall address-list add list=MOROSOS comment="Clientes Suspendidos por ISPMAX"

3. Firewall Rules - Corte por Impago (Redirect to Walled Garden / Web Server)

Asumimos que el servidor ISPMAX tiene la IP 10.0.0.5 y escucha en el puerto 8080 una página de "PAGUE SU FACTURA"

/ip firewall nat
add chain=dstnat action=dst-nat to-addresses=10.0.0.5 to-ports=8080 protocol=tcp dst-port=80 src-address-list=MOROSOS comment="ISPMAX: Redirect HTTP Suspendidos"

/ip firewall filter
add chain=forward action=drop src-address-list=MOROSOS protocol=udp dst-port=53 comment="ISPMAX: Drop DNS Suspendidos"
add chain=forward action=drop src-address-list=MOROSOS comment="ISPMAX: Drop Traffic Suspendidos"

4. QoS Avanzado - PCQ (Per Connection Queue) para equidad general

/queue type
add kind=pcq name=pcq-download-default pcq-classifier=dst-address pcq-rate=0
add kind=pcq name=pcq-upload-default pcq-classifier=src-address pcq-rate=0

Estructura de Árbol de Colas (Queue Tree) si se prefiere sobre Simple Queues

Nota: El backend Python usa Simple Queues por facilidad de gestión 1-a-1

pero aquí definimos padres para priorización global.

/queue simple
add name="TOTAL_TRAFFIC" target=192.168.88.0/24 max-limit=1G/1G comment="ISPMAX: Global Parent"

5. Seguridad Básica (Zero Trust foundation)

/ip firewall filter
add chain=input action=accept protocol=icmp comment="Allow Ping"
add chain=input action=accept connection-state=established,related comment="Allow Established"
add chain=input action=drop in-interface=ether1 comment="Drop all other input on WAN"

6. Watchdog (Auto-healing)

/system watchdog set watch-address=8.8.8.8 no-ping-delay=5m auto-send-supout=yes

7. Usuario API restringido

/user group add name=api_only policy=api,read,write,test,winbox
/user add name=ispmax_api group=api_only password="StrongPassword123!" comment="Usuario para Backend Flask"
